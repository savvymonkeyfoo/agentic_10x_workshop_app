// schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// 1. Workshop Container
model Workshop {
  id          String   @id @default(uuid())
  clientName  String
  clientLogoUrl String?
  workshopDate  DateTime @default(now())
  createdAt   DateTime @default(now())
  status      String   @default("INPUT") // Draft, Input, Analysis
  opportunities Opportunity[]
}

// 2. The Opportunity Asset
model Opportunity {
  id              String   @id @default(uuid())
  workshopId      String
  workshop        Workshop @relation(fields: [workshopId], references: [id])
  
  // Tab A: Strategic Context
  projectName       String
  frictionStatement String
  strategicHorizon  String   // "GROWTH", "OPS", "STRATEGY"
  whyDoIt           String   
  
  // Tab B: The Workflow (Refactored)
  workflowPhases    Json?    // Array of { name, autonomy, guardrail }
  agentDirective    Json?    // DEPRECATED: Kept optional for legacy schema sync
  
  // Tab C: Business Case (VRCC + Financials)
  scoreValue        Int
  scoreCapability   Int
  scoreComplexity   Int
  scoreRiskFinal    Int      @default(0)
  scoreRiskAI       Int      @default(0)
  riskOverrideLog   String?
  tShirtSize        String   // "XS", "S", "M", "L", "XL"
  
  benefitRevenue    Float?
  benefitCost       Float?
  benefitEfficiency Float?
  
  dfvDesirability   String   // "HIGH", "MED", "LOW"
  dfvFeasibility    String
  dfvViability      String

  // Tab D: Execution
  definitionOfDone  String   
  keyDecisions      String   
  impactedSystems   String[]

  // Capability Mapping (New Tagging Fields)
  capabilitiesExisting String[]
  capabilitiesMissing  String[]

  // Logic Engine
  capabilitiesConsumed CapabilityConsumed[]
  capabilitiesProduced CapabilityProduced[]
  
  // Outputs
  sequenceRank    Int?
  matrixX         Float?
  matrixY         Float?
}

// 3. Capabilities
model CapabilityConsumed {
  id            String      @id @default(uuid())
  opportunityId String
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id])
  name          String
  status        String      // "EXISTING" or "MISSING"
}

model CapabilityProduced {
  id            String      @id @default(uuid())
  opportunityId String
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id])
  name          String
}
