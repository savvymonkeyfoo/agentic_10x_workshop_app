// schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// 1. Workshop Container
model Workshop {
  id          String   @id @default(uuid())
  clientName  String
  clientLogoUrl String?
  workshopDate  DateTime @default(now())
  createdAt   DateTime @default(now())
  status      String   @default("INPUT") // Draft, Input, Analysis
  opportunities Opportunity[]
}

// 2. The Opportunity Asset
model Opportunity {
  id              String   @id @default(uuid())
  workshopId      String
  workshop        Workshop @relation(fields: [workshopId], references: [id])
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt

  // Tab A: Strategic Context
  projectName       String
  frictionStatement String
  strategicHorizon  String   // "GROWTH", "OPS", "STRATEGY"
  whyDoIt           String   
  
  // Tab B: The Workflow (Refactored)
  workflowPhases    Json?    // Array of { name, autonomy, guardrail }
  agentDirective    Json?    // DEPRECATED: Kept optional for legacy schema sync
  
  // Tab C: Business Case (VRCC + Financials)
  scoreValue        Int
  scoreCapability   Int
  scoreComplexity   Int
  scoreRiskFinal    Int      @default(0)
  scoreRiskAI       Int      @default(0)
  riskOverrideLog   String?
  tShirtSize        String   // "XS", "S", "M", "L", "XL"
  
  benefitRevenue    Float?
  benefitCostAvoidance Float? // Renamed from benefitCost
  benefitEstCost    Float?   // One-Time Implementation Cost
  benefitEfficiency Float?
  benefitTimeframe  String?   // "Monthly" or "Annually"
  
  // DFV Assessment - JSON structure: { desirability: {score: 1-5, justification: string}, feasibility: {...}, viability: {...} }
  dfvAssessment     Json?

  // Tab D: Execution
  definitionOfDone  String   
  keyDecisions      String   
  impactedSystems   String[]
  
  // New Execution Fields
  systemGuardrails     String?
  aiOpsRequirements    String?
  changeManagement     String?
  trainingRequirements String?

  // Capability Mapping (New Tagging Fields)
  capabilitiesExisting String[]
  capabilitiesMissing  String[]

  // Logic Engine
  capabilitiesConsumed CapabilityConsumed[]
  capabilitiesProduced CapabilityProduced[]
  
  // Outputs
  sequenceRank        Int?
  strategicRationale  String?   @db.Text
  matrixX             Float?
  matrixY             Float?
}

// 3. Capabilities
model CapabilityConsumed {
  id            String      @id @default(uuid())
  opportunityId String
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id])
  name          String
  status        String      // "EXISTING" or "MISSING"
}

model CapabilityProduced {
  id            String      @id @default(uuid())
  opportunityId String
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id])
  name          String
}
